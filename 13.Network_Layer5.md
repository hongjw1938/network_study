### Network Layer5
- 계층적 라우팅
  - AS(Autonomous System)
    - 네트워크가 나누어진 경계를 의미함. 즉, 네트워크는 Interconnected ASes
    - 즉, 각자의 네트워크 내부에서 어떤 정책을 사용할지 지정할 수 있는 범위
    - ![Alt text](/img/13-0.png)
    - 이 AS 내부에서 어떤 라우팅 방식(RIP, OSPF)을 사용할지 지정할 수 있다. 그리고 AS 사이에 지정된 프로토콜이 BGP
- Protocols
  - 아래와 같은 프로토콜이 바로 이전에 배운 알고리즘을 사용하여 인터넷을 연결하기 위해 구현한 프로토콜이다.
  - RIP
    - link state algorithm
  - OSPF
    - distance detect algorithm
  - BGP(Border Gateway Protocol)
    - Internet inter-AS routing
    - 각 AS에 있는 border에 있는 라우터사이에서 경로를 찾기 위한 프로토콜.
    - BGP session
      - two BGP 라우터끼리 메시지 교환
    - ![Alt text](/img/13-1.png)
      - Reachability는 접근성을 의미한다. 즉, Other network쪽을 어떻게 연결할 수 있는가에 대한 것.
      - AS3가 주변에 자신과 연결된 네트워크(AS1)에게 자신의 border에 해당 네트워크가 연결되어 있다고 정보를 주는 것이다.
      - AS2는 AS3를 통해 바깥의 네트워크에 접속할 수 있다는 것을 알 수 있다.(advertised)
    - Routing Policy
      - ![Alt text](/img/13-2.png)
      - 위 사진에 따르면 네트워크 규모에 따라 구분이 되어 있다. 이 경우 A,B,C 즉, 커다른 3개는 provider(KT,SKT등)이다. 나머지는 customer. customer들은 비용을 지불(해당 AS트래픽을 지날 때마다, 왜냐면 그만큼의 인프라를 관리해주는 거니까)
      - 그 때, Provider끼리는 서로 비슷한 수준이기 때문에 서로는 Peer관계라고 한다. 그래서, 서로는 비용을 지불하지 않는다.
      - 여기서 customer x는 B,C와 연결되어 있는데, x는 B가 C와 연결 될 때, 자신을 통해서 될수도 있고,  서로간에 될수도 있다. 근데, 자신을 통해서 하기를 원하지 않는다. 왜냐면 비용 지불해야하니까..
      - 그래서 X는 B에게 C로 가는 경로를 본인이 가지고 있다는 것을 알리지 않는다.
      - 그리고, 다른 예로 Peer들 끼리는 경로를 가르쳐주지 않는 경우도 많다. 왜냐하면, 자신을 그냥 거쳐서만 가는 경우가 있을 수 있기 때문이다.(Peer끼리는 돈을 안내니까.)
    - Choices
      - ![Alt text](/img/13-3.png)
      - 가장 빠른건, 4 1 로 가는 것일 것이다. 근데 Peer니까 돈 안주고 받는다. 근데, 비효율적이지만 3 2 1 방향을 선택하면 아래 쪽 트래픽으로부터 내가 돈을 받을 수 있기 때문에 해당 라우팅을 선택하게 된다.
      - ![Alt text](/img/13-4.png)
      - 즉, 실제로는 최단경로를 이용해 가는게 아니고 비즈니스 목적에 맞게 인터넷이 전달된다.
    - Broadcast routing
      - AS 내부에서만 진행된다. 다른 AS로는 브로드캐스팅이 되지 않음.
      - 하나의 source가 다른 모든 node로 가는 패킷을 각각 만들면 매우 비효율적
      - 그래서, packet을 만들고 보낸 다음, 이후에 복사를 해서 보내는 방식이 쓰임
        - In-network duplication
          - flooding
            - 노드가 브로드캐스트 패킷을 받으면 모든 neighbor들에게 복사해줌
            - 사이클이 형성될 수 있는 문제가 있음.
          - controlled flooding
            - 브로드캐스트 패킷을 받았으면 해당 ID를 기억하여 이미 받은 패킷이면 복사하지 않음
          - Spanning tree
            - 노드간의 연결을 트리로 만들어서 해당 트리를 따라서만 패킷이 전달되도록 지정
            - 가장 효율적인 방법임.
            - 생성 방법
              - center node를 지정하고 다익스트라 알고리즘등을 이용해서 주변과 연결하여 가장 짧은 경로로 복사해서 브로드캐스트
    - Multicast routing
      - 멀티캐스트 그룹에 속한 노드에게만 패킷 전달.
      - 그래서, 그룹에 속하는 라우터를 파악하고 트리를 만들어서 해당 트리를 따라서 패킷을 전달함.
      - Tree
        - Shared Tree
          - 모든 그룹에 동일하게 적용되는 트리
        - Source-Based Tree
          - sender / receiver에 따라 서로 다른 트리
          - 일반적으로 더 효율적
          - Tree 구조
            - Shortest path tree
              - 다익스트라 알고리즘을 사용해서 각 Destination에 도달하는 방식을 파악하고 패킷을 전송하는 방식
            - Reverse Path Forwarding
              - ![Alt text](/img/13-5.png)
