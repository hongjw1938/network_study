### Transportation Layer4
- Congestion control
  - 네트워크의 컨디션에 따라 흐름을 제어하는 것인데, 네트워크의 상태는 어떻게 확인하는가?
    - 네트워크 현상은 특정 상황에 따라 짐작해야 한다.
    - congestion은 너무 많은 소스가 보내져서 네트워크가 핸들하기에 너무 많은 것.
  - Congestion이 발생하면 데이터가 유실될 수 있다. 딜레이가 커질 수 있다.
  - 현실에서는 만약 congestion 때문에 delay가 커질 경우 timeout때문에 재전송이 일어날 수 있어서 같은 내용을 중복해서 보내는 현상이 생길 수 있다(loss가 되지 않았음에도)
    - 이에 따라 throughput(전송되는 양)이 효율적이지 않을 수 있다.
  - 또한, TCP는 재전송 프로세스가 있다.
    - 2kb를 보냈는데 계속 congestion에 의해서 timeout이 발생해서 막힌 상태에서 끝도 없이 보내버리면 큰 문제가 된다. 모든 TCP가 그렇게 하게 되면 congestion이 안풀리니까
    - 그래서, 네트워크 상황에 따라서 데이터를 보낼지 말지 선택해야 한다.
    - 이에 대해서는 2가지 방법이 있다.
      - end-to-end congestion control
        - ![Alt text](/img/8-1.png)
        - 이것은 양쪽 프로세스의 피드백에 따라서 네트워크의 상태를 짐작하는 방식이다.
        - 어떻게 하냐면 segment가 갔는데 ACK가 왔다면 간 것인데, timeout이 되었다면 문제가 있다는 것을 인지하고 네트워크를 짐작하게 된다.
        - Sender는 전송rate를 (window size) 증가시킨다. 언제까지냐면 loss가 발생할 때까지 이다. loss가 발생한다면 보내는 양을 절반으로 확 줄여버린다.
        - Sender는 congestion window size에 따라서 Receiver에 보내기 때문에 sending rate = cwnd / RTT(ACK가 오기 까지의 시간) 이 된다.
        - window size는 맨 처음에 slow start라고 해서 1만 보낸다. ACK가 오면 2보내고,, 이런식으로 계속 증가시키는 것이다. 경험적인 수치로 slow start threshold가 있어서 그 기점에 가기 전에는 지수형태로 증가시키면서 보내지만 그 이후에는 선형으로 증가시키면서 데이터를 보낸다.(즉, 그 기점부터는 congestion이 생길 위험이 있다는 의미다.)
        - TCP는 이런식으로 계속 보내다가 패킷이 유실됐다고 판단할 수도 있다. 예를 들면 Timeout, 3 duplicate Acks이다. 근데, 전자와 후자는 큰 차이가 있다.
        - Timeout은 segment가 네트워크 상태가 안좋다는 거고, 후자는 네트워크 상태는 괜찮은데 유실되었다는 의미이다. 최초에 TCP 타우 버젼에서는 Timeout이 발생하면 무조건 rate를 1까지 내려버렸다.
        - 지금의 버젼인 TCP Reno버젼에서는 그 두가지를 구별해서 3 duplicate 상태일 때는 window size를 반으로 줄이는 방식으로 했고, ss threshold를 좀 내렸꼬, Timeout이면 SS부터 다시 시작하는 방식으로 동작한다.
  - TCP Fairness
    - K개의 TCP 세션이 있다고 하면 bottleneck router에 각각 서로 데이터를 보낼 것인데 Capacity 가 R이라고 한다면 각각 공평하게 R/K 만큼 서로가 양보해서 그만큼의 데이터만 보낼 것인가?
    - TCP는 실제로 그에 수렴하게 만들어 놓는다.
    - ![Alt text](/img/8-0.png)
    - 위 그림과 같이 각자가 ss로 시작을 하게 되지만, 그에 따라 대역폭이 그를 감당할 수 있으므로 계속 size를 늘리게 된다. 근데, 일정 수준(파란선)이 지나면 delay로 인해서 congestion이 발생하게 되고 그에 따라 상호적으로 다시 size를 줄이고 늘리는 방향을 계속해서 진행하기 때문에, R/K에 수렴하도록 할 수가 있는 것이다.
    - 그런데 UDP같은 경우는 저런 내용을 무시하고 통째로 보내버린다. 그래서 유실될 가능성이 높음.
    - 그리고 특정 네트워크 대역에서 TCP연결을 많이 만들어서 진행할 수도 있다. 그러면 특정 사용자 환경에서 Capacity를 대량으로 사용하는 문제가 생길 수도 있다.