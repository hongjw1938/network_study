### Network Security2
- Secure e-mail
  - 이전에 배운 내용과 같음
  - E-mail Message를 안전하게 변조 없이 Sender Authentication을 하기를 원함
  - Receiver의 Public key로 암호화 하고 본인의 Private key로 Sign하여 message와 대칭키를 전달
  - Receiver는 Sign확인하고 본인 키로 복호화하여 이후 대칭키를 기반으로 이메일 전송
- SSL and TCP/IP
  - TCP/IP에는 보안과 관련된 구현이 되어 있지 않음. 그래서 SSL이라는 Layer를 올려서 마치 TCP가 보안 서비스를 제공하는 것 같은 효과를 제공
  - ![Alt text](/img/22-0.png)
    - 이와 같이 SSL Layer를 하나 넣음
    - message를 SSL 소켓으로 보내서 암호화를 한 다음 TCP로 보내는 방식
    - C / Java는 SSL 소켓을 사용할 수 있는 library가 존재함
  - HTTPS가 HTTP에 SSL Layer가 더해진 것임
  - Toy SSL
    - handshake
      - 서로 상대방을 authenticate하는 과정
      - hello 보내면, 서버가 public key, certificate(인증서, 서버정보)를 보내고 해당 키를 기반으로 MS(master secret)을 암호화하여 보냄(EMS: encrypted ms)
      - ![Alt text](/img/22-1.png)
        - certificate을 보내면 해당 서버 정보를 알 수 있어서 해당 서버를 Authenticate 가능
        - 한국의 공인인증서 시스템은 반대임. 고객이 자신의 인증서를 이용해서 본인을 Authenticate하고 있음
        - master secret이 key이며 해당 내용을 공유하면 그를 바탕으로 4가지 key를 만듦
    - Deviate
      - master secret을 바탕으로 4개의 key를 만듦. 하나가 문제가 될 수 있으니까 여러 개를 미리 만들어 놓는 것
    - Data transfer
      - Application으로부터 데이터가 SSL Layer로 내려오면 그것을 암호화하는데 그 기준이 record임
      - ![Alt text](/img/22-2.png)
        - Length는 길이를 의미하며, MAC는 Message authentication code
      - 위와 같이 암호화를 하더라도, 불순한 의도를 가진 외부인이 TCP FIN 과 같은 신호를 보내서 강제로 끊어버리는 행위가 가능
      - 해당 행위를 막기 위해 record type을 사용
        - data를 전송 시 type = 0, closure면 1
        - ![Alt text](/img/22-3.png)
        - 여기서 Data 부분만(Application data) 딱 암호화 되는 것, 전체 Header 정보까지 포함해서 SSL Record라고 부름
    - Connection closure
- Network Layer Security : IPsec
  - 이는 Network Layer에서 SSL처럼 Message Integrity / Authentication과 같은 역할을 해보겠다는 것
  - 왜 굳이? 이미 SSL에서 하고 있는데 사용하는가?
    - SSL과 같은 프로토콜은 무슨 프로토콜 사용하는지, 누구와 통신하는지 등의 모든 Header정보는 감청할 수가 있다.
    - 그래서, Network Layer에서 암호화로 덮어버리면 해당 헤더 정보도 보안에 민감한 경우 안전하게 유지할 수 있게 된다.
  - VPN과 같은 경우에 많이 사용함.
  - ![Alt text](/img/22-4.png)
  - Mode
    - Tunneling mode
      - 가장 널리 쓰이는 방식
      - 본사 / 지사 Gateway Router에서 상호 가상 Tunnel을 만들어서 통신하는 것
    - end-user가 VPN을 사용해서 System에 접근하는 것
