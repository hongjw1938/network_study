### Network Layer1
- Transport Layer
  - 이것은 end-to-end, 즉 프로세스 간의 어떤 신호에 대해서 말하는 것이었다. 그런데 그 사이에서 상호간에 전달을 위한 내용을 이야기한 적이 없다.
  - 실질적으로 그 사이에는 라우터에 의해 출발지 ~ 도착지 까지의 과정이 있다.
  - 여기에서 사용되는 것이 바로 네트워크 계층의 프로토콜이다.
- 라우터
  - 이 라우터에 의해 IP 패킷을 보고 상대 라우터, 프로세스 까지 패킷을 전달하게 된다.
  - 역할
    - Forwarding
      - 패킷을 받아서 패킷의 목적지를 보고 다음 라우터로 보내주는 역할
      - Forwarding Table이 있는데, 이것은 라우팅 기능에 의해서 어느 목적지로 가야한다는 것이 지정되어 있다.(ex. 1111~1113이면 1로, 1114~1116이면 2로 뭐 이런식..) 그래서 그 테이블을 보고 전달을 하게 되는 것
    - Routing
      - Forwarding 테이블을 만드는 방법을 의미한다. 어떤 경로를 따라서 갈지를 결정해 주는 것.
  - Forwarding Table
    - ![Alt text](/img/9-0.png)
    - 이와 같이 어디부터 어디는 어느 곳으로 가라는 식으로 지정되어 있다.
    - 즉, 패킷의 목적지 주소에 따라서 각각이 Table에 지정되어있어서 라우터가 보내면 된다.
  - 라우터 아키텍쳐
    - ![Alt text](/img/9-1.png)
    - 라우팅 알고리즘에 의해 Forwarding 테이블이 만들어진다.
    - 해당 라우팅은 주변 라우터와 통신을 해서 만들어야 하는데, 가장 가까운 거리에 있는 것으로 지정되는데 이 때의 정보 교환을 Control plane이라고 부른다.(다익스트라 알고리즘 사용)
    - 그리고 사용자의 데이터를 forwarding하는 것을 Data plane이라고 부른다.(Input port에서 테이블을 참조해 output port로 보내는 것.)
      - 이 때, Data plane에서 모든 input이 하나의 output으로 가게 되면 큐잉 딜레이가 생기는 것이다..
  - Longest Prefix Match Forwarding
    - ![Alt text](/img/9-2.png)
    - 이와 같이 오는 Input 패킷마다 가장 긴 매칭 prefix에 맞추어서 output으로 보낸다.
- IP
  - 3계층에서 사용하는 프로토콜.
  - Transport Layer에서는 거의 TCP를 사용함. 그래서 인터넷은 TCP/IP기반이라고 부르는 것.
  - 그리고, TCP의 전체 Segment가 Data가 되고 추가적으로 Header정보가 붙는다. 이것이 Packet
  - 패킷 구조
    - ![Alt text](/img/9-3.png)
    - ver은 4/6버젼을 의미. TTL은 몇 홉을 지날 수 있는지를 지정한 것. 라우터 하나 지나면 1홉 감소
    - 왜 TTL을 굳이 만들었을까? 혹시나 테이블이 잘못되어서 영원히 패킷이 라우터를 뱅뱅 돌아다닐 수 있기 때문이다. 그런 경우에 없애버려야함. TTL이 0이되면 패킷 소멸한다.
  - IPv4
    - 32비트 추소체계 사용함. 8비트씩 4개로 끊어서 십진수로 표현함.
    - 체계로 계층화를 시켜서 사용한다. 네트워크 주소 + 호스트 주소
    - CIDR표기법에 따라 /24라고 되어 있으면 앞부분 어디까지가 네트워크 주소라고 지정되어 있는 것. 이것이 prefix
    - 그 prefix만큼 서브넷 마스크가 지정됨.
    - 이를 통해 확장성 있는 IP 주소 체계를 지정할 수 있고, 쉽게 호스트를 추가할 수 있다.
    - 네트워크 Class
      - ![Alt text](/img/9-4.png)
      - A : 첫 비트 0으로 시작. prefix는 /8
        - 실제로 선발주자들이 호스트 많이 사용 가능하니까 다 가져가버림.
      - B : 첫 비트 10으로 시작. prefix는 /16
      - C : 첫 비트 110으로 시작. prefix는 /24
      - D는 멀티캐스트, E는 연구용
    - 위와 같이 Class를 지정해서 사용하게 되면 부족 / 낭비인 경우가 너무 많다. 그래서 Classless방식을 사용함. 그것이 CIDR
    - CIDR(Classless Inter-Domain Routing)
      - ![Alt text](/img/9-5.png)
      - 즉, 어떤 비트든 간에 네트워크 주소로 사용할 수 있는 방식을 사용하였다. 훨씬 유연하게 사용할 수 있다.
  - Subnet
    - 서브넷은 중간에 라우터를 거치지 않고 갈 수 있는 주소 대역의 집합을 의미한다.
    - 즉 라우터를 넘는 다는 것은 서브넷이 다르다는 의미이다.
