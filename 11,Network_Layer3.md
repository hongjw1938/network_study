### Network Layer3
- IP datagram format
  - ![Alt text](/img/11-0.png)
    -  data부분은 TCP헤더가 많이 차지
    - length는 전체길이
    - identifier, flgs, fragment offset은 파편화/재조립시에 사용
- IP 파편화 / reassembly
  - ![Alt text](/img/11-1.png)
    - MTU(Maximum Transter Unit)
      - 각 부분마다 최대로 보낼 수 있는 양이 다르기 때문에 파편화를 해서 보내고 최종 목적지에서 조립을 하게 된다.
    - ![Alt text](/img/11-2.png)
      - 이와 같이 reassembly한다. 
      - 총 보내는 것은 4000바이트이고 최대로 보낼 수 있는 건 1500이라서 3개로 나누어서 보내야한다.
      - 1, 2번째에서는 꽉채워서 보내는데, 헤더가 20바이트 이므로 데이터는 1480바이트이다.
      - offset은 1480/8을 나눈 것인데, 이게 헤더에서 비트 사용하는 것을 좀 줄이려고 사용하는 것임.(뒤에 3개 비트만 버리는 것)
      - 마지막이 1040인것은 헤더 20에 2960만큼 전달된 것 제외.
      - 그리고 최종에서는 offset을 보고 나서 해당 내용이 다 왔다는 것을 알게 되고 그 때, 재조립을 하게 된다.
- ICMP(internet control message protocol)
  - 라우터들이 메세지를 교신하는 걸 제어하기 위한 프로토콜임.
  - Traceroute : unix 커맨드
    - 설정 목적지까지 어떤 경로를 따라가는지 알려주는 명령어
    - TTL을 계속 높여가면서 계속해서 패킷을 보내서 어떤 경로를 지나는지 알아낼 수 있다.
- IPv6
  - Address 공간이 128비트로 확장되었다. 보안 등의 부분이 더 확장됨
  - Tunneling
    - 도중에 IPv4로 동작하는 라우터들이 있기 때문에 IPv6로 패킷을 보낼 때는 중간에 IPv4로 패킷을 다시 담아서 해당 라우터들이 이해할 수 있도록 전달하는 것,
    - ![Alt text](/img/11-3.png)
    - 이를 통해 version변경으로 넘어가는 과정에 문제가 없을 수 있다.
- A Link-State Routing Algorithm
  - 모든 라우터가 네트워크 상황을 알고 있다는 것이 특징임. 즉, 어디까지 링크가 있고 그 사이의 cost가 어떤지를 알고 있다. 어떻게?, 서로간에 브로드캐스틀 다 해야하는 것이다.
  - 즉, link-state라는 것은 링크의 상태를 다 알고 있다는 것을 의미한다.
    - ![Alt text](/img/11-4.png)
    - 이러하게 코스트를 다 알고 있다!(점점 브로드캐스트로 확장하면서 코스트를 업데이트하게 된다.)
    - 그래서 모든 라우터까지의 최소 코스트를 알게 되고 그를 통해 forwarding테이블을 만들게 된다.
    - ![Alt text](/img/11-5.png)
  - 이를 기반으로 다익스트라 알고리즘을 활용해서 라우팅 돌려서 포워딩 테이블을 라우터가 만들게 된다.
